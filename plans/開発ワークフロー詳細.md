# Climb You 開発ワークフロー詳細仕様

## 1. ブランチ戦略

### **Git Flow 簡素版**

```
main (production-ready)
├── develop (integration branch)
│   ├── feature/CY-001-project-setup
│   ├── feature/CY-006-profiling-ui
│   ├── feature/CY-010-quest-generation
│   ├── hotfix/CY-XXX-critical-fix
│   └── release/v1.0.0
└── gh-pages (documentation)
```

### **ブランチ命名規則**
```
feature/CY-{チケット番号}-{機能名}
hotfix/CY-{チケット番号}-{修正内容}
release/v{バージョン番号}
```

**例**:
- `feature/CY-006-profiling-ui`
- `hotfix/CY-025-auth-crash-fix`
- `release/v1.0.0`

### **ブランチ運用ルール**

#### **feature ブランチ**
- **作成元**: `develop` ブランチ
- **マージ先**: `develop` ブランチ
- **ライフサイクル**: チケット完了まで
- **命名**: `feature/CY-XXX-{機能名}`

#### **hotfix ブランチ**
- **作成元**: `main` ブランチ
- **マージ先**: `main` + `develop` ブランチ
- **用途**: 本番環境の緊急修正
- **命名**: `hotfix/CY-XXX-{修正内容}`

#### **release ブランチ**
- **作成元**: `develop` ブランチ
- **マージ先**: `main` + `develop` ブランチ
- **用途**: リリース準備・最終調整
- **命名**: `release/v{MAJOR.MINOR.PATCH}`

## 2. コミット規約

### **Conventional Commits 準拠**

```
<type>(<scope>): <description>

[optional body]

[optional footer(s)]
```

### **Type 定義**
- `feat`: 新機能追加
- `fix`: バグ修正
- `docs`: ドキュメント更新
- `style`: コードスタイル修正（機能に影響なし）
- `refactor`: リファクタリング
- `test`: テスト追加・修正
- `chore`: ビルド・設定ファイル更新

### **Scope 定義**
- `auth`: 認証関連
- `ai`: AI機能関連
- `ui`: UI関連
- `api`: API関連
- `db`: データベース関連
- `config`: 設定関連

### **コミット例**
```
feat(ai): implement profiling analysis with OpenAI API

- Add profiling prompt templates
- Integrate OpenAI API client
- Handle API rate limiting
- Add response validation

Closes CY-007
```

## 3. プルリクエスト（PR）プロセス

### **PR テンプレート**
```markdown
## 概要
このPRの目的と変更内容を簡潔に説明

## 関連チケット
- Closes #[チケット番号]
- Related to #[関連チケット]

## 変更内容
- [ ] 新機能の追加
- [ ] バグ修正
- [ ] リファクタリング
- [ ] ドキュメント更新

## テスト
- [ ] ユニットテスト追加/更新
- [ ] 手動テスト実行
- [ ] E2Eテスト実行

## レビューポイント
レビュアーに特に注意して見てほしい点

## スクリーンショット/動画
（UI変更がある場合）

## チェックリスト
- [ ] コードレビュー準備完了
- [ ] テストが全てパス
- [ ] ドキュメント更新済み
- [ ] Breaking changeなし（または記載済み）
```

### **PR レビュー基準**

#### **必須チェック項目**
- [ ] 受け入れ条件がすべて満たされている
- [ ] コードがプロジェクトの規約に準拠している
- [ ] テストが適切に書かれ、パスしている
- [ ] セキュリティ上の問題がない
- [ ] パフォーマンスに悪影響がない

#### **コードレビューチェックポイント**
- [ ] **可読性**: コードが理解しやすい
- [ ] **保守性**: 将来の変更に対応しやすい
- [ ] **再利用性**: 適切にコンポーネント化されている
- [ ] **エラーハンドリング**: 適切な例外処理
- [ ] **TypeScript**: 型安全性が確保されている

### **マージ戦略**
- **feature → develop**: Squash and merge
- **hotfix → main**: Create a merge commit
- **release → main**: Create a merge commit

## 4. CI/CD パイプライン

### **GitHub Actions ワークフロー**

#### **PR チェック（.github/workflows/pr-check.yml）**
```yaml
name: PR Check
on:
  pull_request:
    branches: [develop, main]

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
        with:
          node-version: '18'
      - run: npm ci
      - run: npm run lint
      - run: npm run type-check
      - run: npm run test
      - run: npm run build-check
```

#### **デプロイメント（.github/workflows/deploy.yml）**
```yaml
name: Deploy
on:
  push:
    branches: [main]

jobs:
  deploy-staging:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm ci
      - run: npm run test
      - run: expo build
      - run: expo publish --release-channel staging
  
  deploy-production:
    needs: deploy-staging
    if: startsWith(github.ref, 'refs/tags/v')
    runs-on: ubuntu-latest
    steps:
      - run: expo publish --release-channel production
```

## 5. 品質保証プロセス

### **段階別テスト戦略**

#### **開発段階**
```
Developer → 
├── Unit Tests (Jest)
├── Type Check (TypeScript)
├── Linting (ESLint)
└── Format Check (Prettier)
```

#### **統合段階**
```
PR → 
├── Integration Tests
├── Component Tests (React Testing Library)
├── API Tests
└── E2E Tests (Detox)
```

#### **リリース段階**
```
Release Candidate → 
├── Manual QA Testing
├── Performance Testing
├── Security Audit
└── User Acceptance Testing
```

### **テスト自動化**

#### **ユニットテスト**
```javascript
// 例: AI サービスのテスト
describe('QuestGenerationService', () => {
  it('should generate quests based on user profile', async () => {
    const service = new QuestGenerationService();
    const profile = mockUserProfile();
    
    const quests = await service.generateDailyQuests(profile);
    
    expect(quests).toHaveLength(3);
    expect(quests[0]).toHaveProperty('title');
    expect(quests[0]).toHaveProperty('difficulty');
  });
});
```

#### **E2E テスト**
```javascript
// 例: オンボーディングフローのテスト
describe('Onboarding Flow', () => {
  it('should complete profiling successfully', async () => {
    await device.launchApp();
    
    // Step 1: Basic Info
    await element(by.id('age-range-20s')).tap();
    await element(by.id('next-button')).tap();
    
    // Step 2: Learning Style
    await element(by.id('motivation-achievement')).tap();
    await element(by.id('next-button')).tap();
    
    // Step 3: Goal Setting
    await element(by.id('goal-input')).typeText('TOEIC 800');
    await element(by.id('analyze-button')).tap();
    
    // Verify AI analysis result
    await expect(element(by.id('analysis-result'))).toBeVisible();
  });
});
```

## 6. 開発環境セットアップ

### **必須ツール**
```bash
# Node.js環境
nvm install 18
nvm use 18

# Expo CLI
npm install -g @expo/cli

# React Native デバッグツール
npm install -g react-native-debugger

# Git hooks
npm install -g husky lint-staged
```

### **VS Code 推奨拡張機能**
```json
{
  "recommendations": [
    "bradlc.vscode-tailwindcss",
    "esbenp.prettier-vscode",
    "ms-vscode.vscode-typescript-next",
    "expo.vscode-expo-tools",
    "ms-vscode.vscode-json"
  ]
}
```

### **プロジェクト設定ファイル**

#### **package.json scripts**
```json
{
  "scripts": {
    "start": "expo start",
    "android": "expo start --android",
    "ios": "expo start --ios",
    "web": "expo start --web",
    "test": "jest",
    "test:watch": "jest --watch",
    "test:e2e": "detox test",
    "lint": "eslint . --ext .ts,.tsx",
    "lint:fix": "eslint . --ext .ts,.tsx --fix",
    "type-check": "tsc --noEmit",
    "build-check": "expo export"
  }
}
```

#### **.husky/pre-commit**
```bash
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

npm run lint
npm run type-check
npm run test
```

## 7. 課題管理・コミュニケーション

### **スプリント運営**

#### **2週間スプリント構成**
```
Sprint Planning (月曜 9:00-11:00)
├── バックログリファインメント
├── スプリント目標設定
├── タスク見積もり
└── 担当者アサイン

Daily Standup (平日 9:30-9:45)
├── 昨日の進捗
├── 今日の予定
└── ブロッカー共有

Sprint Review (金曜 14:00-15:00)
├── 完了機能のデモ
├── ステークホルダーフィードバック
└── 次スプリントへの改善点

Retrospective (金曜 15:30-16:30)
├── Keep (良かった点)
├── Problem (課題)
└── Try (次回試すこと)
```

### **コミュニケーションツール**
- **Slack**: 日常コミュニケーション
- **Zoom**: スプリント会議・レビュー
- **GitHub Issues**: バグ報告・機能要望
- **Notion**: ドキュメント・議事録

### **レポーティング**

#### **週次レポート形式**
```markdown
# Week XX Progress Report

## 完了チケット
- [CY-XXX] 機能名 - 完了日
- [CY-XXX] 機能名 - 完了日

## 進行中チケット
- [CY-XXX] 機能名 - 進捗率XX% - 予定完了日

## ブロッカー・課題
- 課題内容 - 対応策

## 次週の予定
- チケット一覧

## メトリクス
- ベロシティ: XXpt
- バーンダウン率: XX%
- バグ件数: XX件
```

この詳細ワークフローにより、品質を保ちながら効率的に「Climb You」を開発できます。